# job4 14 months

## just work stuff

### _job4_ 14 months

There's the usually chores of keeping blockchains up to date,
and running, and dealing with various incidents caused by the network,
client overloads, etc.
This triggers more work on resiliency, fallbacks between unreliable upstreams,
and more frequent snapshotting.

One of the things to come out of incident was wanting better gateway level metrics.
As blockchains use a lot of JSONRPC,
we wanted to extract JSONRPC methods from request bodies to headers
[in Traefik using a plugin](https://plugins.traefik.io/create),
so we could [use those in metrics](https://doc.traefik.io/traefik/reference/install-configuration/observability/metrics/#headerlabels).
Turns out you can [only label request count](https://github.com/traefik/traefik/issues/10774) metrics this way....

More work on incidents led to optimizing DNS queries,
and installing [node-local-dns](https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dns/nodelocaldns)
in our clusters for a 10x decrease in DNS latency
in combination with changing ndots to 2.

All the above was complicated by needing to do infra upgrades,
just so I can make the actual changes I want.
E.g. redoing our install of kube-prometheus-stack because the CRD manifests were too big for k8s annotations,
then the entire manifest was too big for argocd grpc messages...

As for project work, a lot of time was spent trying to build out a proof od concept with [Kargo](http://kargo.io/).
But then we realized that the project was just fake open source,
with maintainers only really caring about enterprise.
So we'll probably go with [GitOps Promoter](https://github.com/argoproj-labs/gitops-promoter) instead.
